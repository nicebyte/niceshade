<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>niceshade: niceshade</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">niceshade
   </div>
   <div id="projectbrief">A wrapper for the Microsoft DirectXShaderCompiler and SPIRV-Cross.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">niceshade </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This is the reference documentation for the <a href="http://github.com/nicebyte/niceshade">niceshade</a> library, which can be used by applications to transform HLSL code into shaders for one of the supported backends. See the niceshade <a href="http://github.com/nicebyte/niceshade/blob/master/README.md">readme file</a> for more information about the capabilities, as well as documentation for the accompanying CLI tool.</p>
<p >Read below for a brief tutorial, or skip ahead to the detailed documentation of the <a class="el" href="namespaceniceshade.html">niceshade</a> namespace members.</p>
<h2><a class="anchor" id="build"></a>
Building and Linking Against the Library</h2>
<p ><code>libniceshade</code> is continuously built and tested under Windows, macOS and Linux. The only supported build system is <a href="http://cmake.org">CMake</a>, and the only build-time dependency is <a href="http://github.com/KhronosGroup/SPIRV-Cross">SPIRV-Cross</a>. <code>libniceshade</code> comes bundled with a copy of SPIRV-Cross that it has been tested to work with. In order to use <code>libniceshade</code> from your application, link your own CMake target against the <code>libniceshade</code> target defined in <a href="http://github.com/nicebyte/niceshade/blob/master/libniceshade/CMakeLists.txt"><code>libniceshade/CMakeLists.txt</code></a>.</p>
<h2><a class="anchor" id="rtdeps"></a>
Runtime Dependencies</h2>
<p >At runtime, <code>libniceshade</code> depends on the Microsoft <a href="http://github.com/microsoft/DirectXShaderCompiler">DirectXShaderCompiler</a> shared library. The DirectXShaderCompiler shared library file should be present in a location known to your application. <code>libniceshade</code> comes with pre-built Windows, macOS and Linux versions of the DirectXShaderCompiler shared library that it has been tested to work with.</p>
<h2><a class="anchor" id="usage"></a>
Using the Library</h2>
<h3><a class="anchor" id="hdrs"></a>
Headers</h3>
<p >To be able to use <code>libniceshade</code> types and routines in your application, you must add the following line to your includes:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;libniceshade/niceshade.h&quot;</span></div>
</div><!-- fragment --> <h3><a class="anchor" id="instance"></a>
Creating Objects</h3>
<p >All classes in <code>libniceshade</code> that can be instantiated by the client application and have non-trivial initialization logic, should be instantiated using their corresponding <code>create</code> static method. For example, to instantiate <a class="el" href="classniceshade_1_1instance.html">niceshade::instance</a>, <a class="el" href="classniceshade_1_1instance.html#a3b25cf6daee7fb182ffac4ab7000390d">niceshade::instance::create</a> should be used. This rule does not apply to structs (which have trivial initialization).</p>
<h3><a class="anchor" id="errs"></a>
Error Handling</h3>
<p >All client-facing methods that may fail return values wrapped into <a class="el" href="classniceshade_1_1value__or__error.html">niceshade::value_or_error</a>. No client-facing method in <code>libniceshade</code> ever throws an exception.</p>
<h3><a class="anchor" id="inst"></a>
Creating a Compiler Instance</h3>
<p >Start by populating a <a class="el" href="structniceshade_1_1instance_1_1options.html">niceshade::instance::options</a> structure. You will need to supply:</p>
<ul>
<li>The shader model that your source HLSL uses (e.g. 6_2);</li>
<li>the path to the folder where the Microsoft DirectXShaderCompiler shared library can be found at runtime;</li>
<li>a string containing additional parameters that shall be passed directly to Microsoft DirectXShaderCompiler.</li>
</ul>
<p >Below is an example of what code populating the instance options could look like:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structniceshade_1_1instance_1_1options.html">niceshade::instance::options</a> ns_opts {</div>
<div class="line">  <span class="stringliteral">&quot;6_2&quot;</span>,   <span class="comment">// use SM 6.2</span></div>
<div class="line">  <span class="stringliteral">&quot;-Zpc&quot;</span>,  <span class="comment">// additional DirectXShaderCompiler option: forbid overriding explicit matrix</span></div>
<div class="line">orientation</div>
<div class="line">  <span class="stringliteral">&quot;./&quot;</span>     <span class="comment">// tells niceshade to look for the DirectXShaderCompiler shared library in the current</span></div>
<div class="line">working directory</div>
<div class="line">};</div>
<div class="ttc" id="astructniceshade_1_1instance_1_1options_html"><div class="ttname"><a href="structniceshade_1_1instance_1_1options.html">niceshade::instance::options</a></div><div class="ttdef"><b>Definition:</b> instance.h:52</div></div>
</div><!-- fragment --><p >After that, create a new compiler instance like so:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> maybe_ns_instance = <a class="code hl_function" href="classniceshade_1_1instance.html#a3b25cf6daee7fb182ffac4ab7000390d">niceshade::instance::create</a>(ns_opts);</div>
<div class="ttc" id="aclassniceshade_1_1instance_html_a3b25cf6daee7fb182ffac4ab7000390d"><div class="ttname"><a href="classniceshade_1_1instance.html#a3b25cf6daee7fb182ffac4ab7000390d">niceshade::instance::create</a></div><div class="ttdeci">static value_or_error&lt; instance &gt; create(const options &amp;opts)</div></div>
</div><!-- fragment --><p >Don't forget to check for errors:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (maybe_ns_instance.is_error()) {</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;niceshade error: [%s]&quot;</span>, maybe_ns_instance.error_message().c_str());</div>
<div class="line">  exit(1);</div>
<div class="line">}</div>
<div class="line"><span class="keyword">auto</span>&amp; ns_instance = maybe_ns_instance.get();</div>
</div><!-- fragment --><h3><a class="anchor" id="compiling"></a>
Compiling HLSL</h3>
<p >If you have a piece of HLSL code with techniques defined inline, use <a class="el" href="classniceshade_1_1instance.html#a1d2b5ad983d76493b537575b9638e35b">niceshade::instance::parse_techniques_and_compile</a> to compile all the techniques for your desired targets.</p>
<p >Begin by loading your HLSL:</p>
<div class="fragment"><div class="line"><span class="comment">// assume hlsl_string is loaded from a file somehow</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_typedef" href="namespaceniceshade.html#a856d85f576346e51f838522e8d4aad40">input_blob</a> = <a class="code hl_class" href="classniceshade_1_1span.html">niceshade::input_blob</a> { hlsl_string.data(), hlsl_string.size() };</div>
<div class="ttc" id="aclassniceshade_1_1span_html"><div class="ttname"><a href="classniceshade_1_1span.html">niceshade::span</a></div><div class="ttdoc">Replacement for std::span to avoid requiring C++20.</div><div class="ttdef"><b>Definition:</b> span.h:30</div></div>
<div class="ttc" id="anamespaceniceshade_html_a856d85f576346e51f838522e8d4aad40"><div class="ttname"><a href="namespaceniceshade.html#a856d85f576346e51f838522e8d4aad40">niceshade::input_blob</a></div><div class="ttdeci">const_span&lt; std::byte &gt; input_blob</div><div class="ttdef"><b>Definition:</b> common-types.h:65</div></div>
</div><!-- fragment --><p >The next step is listing your target platforms. The example below targets Metal 1.2 for iOS and OpenGL ES 3.2:</p>
<div class="fragment"><div class="line">std::vector&lt;niceshade::target_desc&gt; targets {</div>
<div class="line"> { niceshade::target_api::METAL, 1, 2, <a class="code hl_enumvalue" href="namespaceniceshade.html#a6ee1fd165c441ff76eac202c6340fb6aad9e3110063ba107ab79340dceebc2d7b">niceshade::target_platform_class::MOBILE</a>},</div>
<div class="line"> { niceshade::target_api::GL, 3, 2, <a class="code hl_enumvalue" href="namespaceniceshade.html#a6ee1fd165c441ff76eac202c6340fb6aad9e3110063ba107ab79340dceebc2d7b">niceshade::target_platform_class::MOBILE</a>}</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceniceshade_html_a6ee1fd165c441ff76eac202c6340fb6aad9e3110063ba107ab79340dceebc2d7b"><div class="ttname"><a href="namespaceniceshade.html#a6ee1fd165c441ff76eac202c6340fb6aad9e3110063ba107ab79340dceebc2d7b">niceshade::target_platform_class::MOBILE</a></div><div class="ttdeci">@ MOBILE</div></div>
</div><!-- fragment --><p >You may also supply additional preprocessor definitions that shall be added when compiling your techniques:</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="namespaceniceshade.html#ab68a122ddb2ebcfeca32130e322d0122">niceshade::define_container</a> additional_definitions {</div>
<div class="line"> {<span class="stringliteral">&quot;define1&quot;</span>, <span class="stringliteral">&quot;value1&quot;</span>}</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceniceshade_html_ab68a122ddb2ebcfeca32130e322d0122"><div class="ttname"><a href="namespaceniceshade.html#ab68a122ddb2ebcfeca32130e322d0122">niceshade::define_container</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; std::string, std::string &gt; &gt; define_container</div><div class="ttdef"><b>Definition:</b> common-types.h:55</div></div>
</div><!-- fragment --><p >Finally, you may call niceshade::instance::parse_techniques_and_compile:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> maybe_results = ns_instance.parse_techniques_and_compile(</div>
<div class="line">   input_blob,</div>
<div class="line">  <span class="stringliteral">&quot;your_file_name.hlsl&quot;</span>,</div>
<div class="line">   <a class="code hl_class" href="classniceshade_1_1span.html">niceshade::const_span&lt;target_desc&gt;</a> {targets.data(), targets.size()},</div>
<div class="line">   additional_definitions);</div>
</div><!-- fragment --><p >Note that passing in the correct file name is important if your HLSL code contains <code>#include</code> directives.</p>
<p >The value returned by the method shall contain an error message if compiling the HLSL code fails:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (maybe_results.is_error()) {</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Error while compiling HLSL: %s&quot;</span>, maybe_results.error_message().c_str());</div>
<div class="line">  exit(1);</div>
<div class="line">}</div>
</div><!-- fragment --><p >If the compilation is successful, the returned value is a tuple, where the first element is a sequence of technique descriptions, and the second element is a sequence of corresponding <a class="el" href="structniceshade_1_1compiled__technique.html">niceshade::compiled_technique</a> objects containing the shader code for each requested target, as well as information about resources consumed by the shader (<a class="el" href="classniceshade_1_1pipeline__layout.html">niceshade::pipeline_layout</a>), and other metadata. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
